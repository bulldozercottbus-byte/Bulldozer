<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Club Intern</title>

<!-- Firebase COMPAT (fÃ¼r GitHub Pages notwendig) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body {
  margin: 0;
  background: #0f0f0f;
  color: #eee;
  font-family: Arial, sans-serif;
}
.hidden { display: none; }

.center {
  text-align: center;
  margin-top: 120px;
}

nav {
  background: #000;
  padding: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

nav button {
  background: none;
  border: none;
  color: #fff;
  cursor: pointer;
}

.box {
  background: #1c1c1c;
  padding: 20px;
  margin: 20px;
  border-radius: 8px;
}

.admin {
  border: 2px solid #a00;
}

input, select {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
  margin-bottom: 12px;
  background: #111;
  border: 1px solid #333;
  color: #fff;
}

button {
  padding: 10px;
  background: #333;
  color: #fff;
  border: none;
  cursor: pointer;
}
button:hover {
  background: #555;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginView" class="center">
  <h1>Club Interner Bereich</h1>
  <input id="loginEmail" placeholder="E-Mail">
  <input id="loginPassword" type="password" placeholder="Passwort">
  <button id="loginBtn">Login</button>
  <p id="loginError" style="color:#f55;"></p>
</div>

<!-- DASHBOARD -->
<div id="dashboardView" class="hidden">

  <nav>
    <span id="navUser"></span>
    <button id="logoutBtn">Logout</button>
  </nav>

  <div id="profileBox" class="box"></div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" class="box admin hidden">
    <h2>ðŸ”§ Admin â€“ User anlegen</h2>

    <input id="newEmail" placeholder="E-Mail">
    <input id="newPassword" type="password" placeholder="Start-Passwort">
    <input id="newName" placeholder="Name / Spitzname">

    <select id="newRank">
      <option value="hangaround">Hangaround</option>
      <option value="prospect">Prospect</option>
      <option value="member">Member</option>
      <option value="road_captain">Road Captain</option>
      <option value="sergeant_at_arms">Sergeant-at-Arms</option>
      <option value="secretary">Secretary</option>
      <option value="treasurer">Treasurer</option>
      <option value="vice_president">Vice President</option>
      <option value="president">President</option>
    </select>

    <input id="newSince" type="date">
    <button id="createUserBtn">User erstellen</button>
    <p id="adminMsg"></p>
  </div>

</div>

<script>
// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyCnFEjFOcrpwjHtVnQ_-QssGtEhY__FzDk",
  authDomain: "bulldozer-f8a26.firebaseapp.com",
  projectId: "bulldozer-f8a26",
  storageBucket: "bulldozer-f8a26.firebasestorage.app",
  messagingSenderId: "576318762826",
  appId: "1:576318762826:web:7d812e32e152d64d425bb3"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ================= LOGIN =================
document.getElementById("loginBtn").addEventListener("click", () => {
  document.getElementById("loginError").innerText = "";

  auth.signInWithEmailAndPassword(
    loginEmail.value.trim(),
    loginPassword.value
  ).catch(err => {
    document.getElementById("loginError").innerText = err.message;
  });
});

// ================= LOGOUT =================
document.getElementById("logoutBtn").addEventListener("click", () => {
  auth.signOut();
});

// ================= AUTH STATE =================
auth.onAuthStateChanged(user => {
  if (!user) {
    document.getElementById("loginView").classList.remove("hidden");
    document.getElementById("dashboardView").classList.add("hidden");
    return;
  }

  document.getElementById("loginView").classList.add("hidden");
  document.getElementById("dashboardView").classList.remove("hidden");

  db.collection("users").doc(user.uid).get()
    .then(doc => {
      if (!doc.exists) {
        alert("FEHLER: Kein User-Dokument in Firestore");
        return;
      }

      const d = doc.data();

      document.getElementById("navUser").innerText =
        d.name + " (" + d.rank + ")";

      document.getElementById("profileBox").innerHTML = `
        <strong>Name:</strong> ${d.name}<br>
        <strong>Rang:</strong> ${d.rank}<br>
        <strong>Mitglied seit:</strong> ${d.memberSince}
      `;

      if (d.isAdmin === true) {
        document.getElementById("adminPanel").classList.remove("hidden");
      } else {
        document.getElementById("adminPanel").classList.add("hidden");
      }
    })
    .catch(err => {
      alert("Firestore-Fehler: " + err.message);
    });
});

// ================= ADMIN: USER ERSTELLEN =================
document.getElementById("createUserBtn").addEventListener("click", () => {
  adminMsg.innerText = "";

  auth.createUserWithEmailAndPassword(
    newEmail.value.trim(),
    newPassword.value
  )
  .then(cred => {
    return db.collection("users").doc(cred.user.uid).set({
      name: newName.value,
      rank: newRank.value,
      memberSince: newSince.value,
      isAdmin: false,
      active: true,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
  })
  .then(() => {
    adminMsg.innerText = "User erfolgreich erstellt âœ…";
  })
  .catch(err => {
    adminMsg.innerText = err.message;
  });
});
</script>

</body>
</html>
